<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ø§Ú©Ø³ØªØ§Ù† Ø³Ø¨Ø²ÛŒ Ù…Ù†ÚˆÛŒ Ø±ÛŒÙ¹Ø³ | Pakistan Sabzi Mandi Rates</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, sans-serif; }
        body { background: #f0f8f0; color: #333; line-height: 1.6; padding: 15px; }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(to right, #006400, #228B22);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .header h1 { font-size: 2.2rem; margin-bottom: 10px; }
        .header p { font-size: 1.1rem; opacity: 0.9; }
        
        .city-tabs {
            display: flex;
            background: #e8f5e8;
            padding: 10px;
            gap: 10px;
            overflow-x: auto;
        }
        
        .tab-btn {
            padding: 12px 25px;
            border: none;
            background: white;
            color: #228B22;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            white-space: nowrap;
            border: 2px solid #228B22;
            transition: all 0.3s;
        }
        
        .tab-btn.active, .tab-btn:hover {
            background: #228B22;
            color: white;
            transform: translateY(-2px);
        }
        
        .market-card {
            padding: 20px;
            display: none;
        }
        
        .market-card.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .market-title {
            color: #006400;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e8f5e8;
        }
        
        .veg-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .veg-table th {
            background: #e8f5e8;
            color: #006400;
            padding: 12px 15px;
            text-align: right;
            border-bottom: 2px solid #228B22;
        }
        
        .veg-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .veg-table tr:hover {
            background: #f9fff9;
        }
        
        .price {
            color: #d32f2f;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .update-time {
            background: #fff3cd;
            padding: 12px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            color: #856404;
            border: 1px solid #ffeaa7;
            font-size: 0.9rem;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            background: #f8f9fa;
            margin-top: 30px;
            border-top: 1px solid #ddd;
        }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 1.8rem; }
            .city-tabs { flex-direction: column; }
            .tab-btn { width: 100%; }
            .veg-table { font-size: 0.9rem; }
            .veg-table th, .veg-table td { padding: 8px 10px; }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            animation: slideIn 0.3s;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Notification -->
    <div class="notification" id="notification"></div>
    
    <div class="container">
        <div class="header">
            <h1>ğŸ‡µğŸ‡° Ù¾Ø§Ú©Ø³ØªØ§Ù† Ø³Ø¨Ø²ÛŒ Ù…Ù†ÚˆÛŒ Ø±ÛŒÙ¹Ø³</h1>
            <p>Pakistan Sabzi Mandi Live Rates - Multan, Khanewal, Kabirwala</p>
        </div>
        
        <!-- City Tabs -->
        <div class="city-tabs">
            <button class="tab-btn active" onclick="showCity('multan')">Ù…Ù„ØªØ§Ù† | Multan</button>
            <button class="tab-btn" onclick="showCity('khanewal')">Ø®Ø§Ù†ÛŒÙˆØ§Ù„ | Khanewal</button>
            <button class="tab-btn" onclick="showCity('kabirwala')">Ú©Ø¨ÛŒØ±ÙˆØ§Ù„Û | Kabirwala</button>
        </div>
        
        <!-- Multan Market -->
        <div class="market-card active" id="multan-card">
            <h2 class="market-title">ğŸ™ï¸ Ù…Ù„ØªØ§Ù† ÙØ±ÙˆÙ¹ Ø§ÛŒÙ†Úˆ Ø³Ø¨Ø²ÛŒ Ù…Ù†ÚˆÛŒ | Multan Fruit & Vegetable Market</h2>
            <table class="veg-table">
                <thead>
                    <tr>
                        <th>Ø³Ø¨Ø²ÛŒ | Vegetable</th>
                        <th>Ù‚ÛŒÙ…Øª | Price</th>
                        <th>ÛŒÙˆÙ†Ù¹ | Unit</th>
                        <th>Ú©ÙˆØ§Ù„Ù¹ÛŒ | Quality</th>
                    </tr>
                </thead>
                <tbody id="multan-rates">
                    <!-- JavaScript se load hoga -->
                </tbody>
            </table>
            <div class="update-time" id="multan-update">
                âœ… Ø¢Ø®Ø±ÛŒ Ø§Ù¾ ÚˆÛŒÙ¹: Ù„ÙˆÚˆ ÛÙˆ Ø±ÛØ§ ÛÛ’... | Last Update: Loading...
            </div>
        </div>
        
        <!-- Khanewal Market -->
        <div class="market-card" id="khanewal-card">
            <h2 class="market-title">ğŸ™ï¸ Ø®Ø§Ù†ÛŒÙˆØ§Ù„ ÛÙˆÙ„ Ø³ÛŒÙ„ Ù…Ø§Ø±Ú©ÛŒÙ¹ | Khanewal Wholesale Market</h2>
            <table class="veg-table">
                <thead>
                    <tr>
                        <th>Ø³Ø¨Ø²ÛŒ | Vegetable</th>
                        <th>Ù‚ÛŒÙ…Øª | Price</th>
                        <th>ÛŒÙˆÙ†Ù¹ | Unit</th>
                        <th>Ú©ÙˆØ§Ù„Ù¹ÛŒ | Quality</th>
                    </tr>
                </thead>
                <tbody id="khanewal-rates">
                    <!-- JavaScript se load hoga -->
                </tbody>
            </table>
            <div class="update-time" id="khanewal-update">
                âœ… Ø¢Ø®Ø±ÛŒ Ø§Ù¾ ÚˆÛŒÙ¹: Ù„ÙˆÚˆ ÛÙˆ Ø±ÛØ§ ÛÛ’... | Last Update: Loading...
            </div>
        </div>
        
        <!-- Kabirwala Market -->
        <div class="market-card" id="kabirwala-card">
            <h2 class="market-title">ğŸ™ï¸ Ú©Ø¨ÛŒØ±ÙˆØ§Ù„Û Ø²Ø±Ø¹ÛŒ Ù…Ø§Ø±Ú©ÛŒÙ¹ | Kabirwala Agricultural Market</h2>
            <table class="veg-table">
                <thead>
                    <tr>
                        <th>Ø³Ø¨Ø²ÛŒ | Vegetable</th>
                        <th>Ù‚ÛŒÙ…Øª | Price</th>
                        <th>ÛŒÙˆÙ†Ù¹ | Unit</th>
                        <th>Ú©ÙˆØ§Ù„Ù¹ÛŒ | Quality</th>
                    </tr>
                </thead>
                <tbody id="kabirwala-rates">
                    <!-- JavaScript se load hoga -->
                </tbody>
            </table>
            <div class="update-time" id="kabirwala-update">
                âœ… Ø¢Ø®Ø±ÛŒ Ø§Ù¾ ÚˆÛŒÙ¹: Ù„ÙˆÚˆ ÛÙˆ Ø±ÛØ§ ÛÛ’... | Last Update: Loading...
            </div>
        </div>
        
        <footer>
            <p>Â© 2024 Ù¾Ø§Ú©Ø³ØªØ§Ù† Ø³Ø¨Ø²ÛŒ Ù…Ù†ÚˆÛŒ Ø±ÛŒÙ¹Ø³ | Pakistan Sabzi Mandi Rates</p>
            <p>ğŸ“ Ø±Ø§Ø¨Ø·Û: info@sabzimandipakistan.com | ğŸ“ Ù…Ù„ØªØ§Ù†ØŒ Ù¾Ø§Ú©Ø³ØªØ§Ù†</p>
            <p style="margin-top: 15px;">
                <a href="admin.html" style="color: #228B22; text-decoration: none; font-weight: bold;">
                    ğŸ” Ø§ÛŒÚˆÙ…Ù† Ù¾ÛŒÙ†Ù„ | Admin Panel (Ù¾Ø§Ø³ÙˆØ±Úˆ Ø³Û’ Ù…Ø­ÙÙˆØ¸)
                </a>
            </p>
        </footer>
    </div>

    <!-- COMPLETE JAVASCRIPT -->
    <script>
        // Database Class
        class SabziMandiDB {
            constructor() {
                this.DB_KEY = 'pakistan_mandi_db_v3';
                this.initDatabase();
            }
            
            initDatabase() {
                if (!localStorage.getItem(this.DB_KEY)) {
                    const defaultData = {
                        version: 3,
                        last_updated: new Date().toISOString(),
                        cities: ['multan', 'khanewal', 'kabirwala'],
                        vegetables: [
                            {id: 1, name: 'tomato', urdu: 'Ù¹Ù…Ø§Ù¹Ø±'},
                            {id: 2, name: 'onion', urdu: 'Ù¾ÛŒØ§Ø²'},
                            {id: 3, name: 'potato', urdu: 'Ø¢Ù„Ùˆ'},
                            {id: 4, name: 'cucumber', urdu: 'Ú©Ú¾ÛŒØ±Ø§'},
                            {id: 5, name: 'capsicum', urdu: 'Ø´Ù…Ù„Û Ù…Ø±Ú†'},
                            {id: 6, name: 'spinach', urdu: 'Ù¾Ø§Ù„Ú©'},
                            {id: 7, name: 'carrot', urdu: 'Ú¯Ø§Ø¬Ø±'},
                            {id: 8, name: 'brinjal', urdu: 'Ø¨ÛŒÙ†Ú¯Ù†'},
                            {id: 9, name: 'chilli', urdu: 'Ù…Ø±Ú†'},
                            {id: 10, name: 'cauliflower', urdu: 'Ù¾Ú¾ÙˆÙ„ Ú¯ÙˆØ¨Ú¾ÛŒ'}
                        ],
                        rates: this.getDefaultRates()
                    };
                    this.saveData(defaultData);
                    console.log('Database initialized with default data');
                }
            }
            
            getDefaultRates() {
                const today = this.getTodayDate();
                return [
                    {id: 1, city: 'multan', veg_id: 1, price: '85', unit: 'kg', quality: 'good', date: today},
                    {id: 2, city: 'multan', veg_id: 2, price: '65', unit: 'kg', quality: 'medium', date: today},
                    {id: 3, city: 'multan', veg_id: 3, price: '48', unit: 'kg', quality: 'fresh', date: today},
                    {id: 4, city: 'multan', veg_id: 4, price: '55', unit: 'kg', quality: 'good', date: today},
                    {id: 5, city: 'khanewal', veg_id: 1, price: '82', unit: 'kg', quality: 'good', date: today},
                    {id: 6, city: 'khanewal', veg_id: 2, price: '62', unit: 'kg', quality: 'medium', date: today},
                    {id: 7, city: 'kabirwala', veg_id: 1, price: '88', unit: 'kg', quality: 'good', date: today},
                    {id: 8, city: 'kabirwala', veg_id: 3, price: '50', unit: 'kg', quality: 'fresh', date: today}
                ];
            }
            
            getTodayDate() {
                return new Date().toISOString().split('T')[0];
            }
            
            getRatesByCity(city) {
                const data = JSON.parse(localStorage.getItem(this.DB_KEY));
                const today = this.getTodayDate();
                
                const cityRates = data.rates.filter(rate => 
                    rate.city === city && rate.date === today
                );
                
                // Map vegetable names
                return cityRates.map(rate => {
                    const veg = data.vegetables.find(v => v.id === rate.veg_id);
                    return {
                        ...rate,
                        vegetable_name: veg ? veg.name : 'Unknown',
                        vegetable_urdu: veg ? veg.urdu : 'Ù†Ø§Ù…Ø¹Ù„ÙˆÙ…'
                    };
                });
            }
            
            getAllRates() {
                const data = JSON.parse(localStorage.getItem(this.DB_KEY));
                return data ? data.rates : [];
            }
            
            addRate(city, veg_id, price, unit = 'kg', quality = 'good') {
                const data = JSON.parse(localStorage.getItem(this.DB_KEY));
                const newId = Date.now();
                
                const newRate = {
                    id: newId,
                    city: city,
                    veg_id: parseInt(veg_id),
                    price: price.toString(),
                    unit: unit,
                    quality: quality,
                    date: this.getTodayDate()
                };
                
                data.rates.push(newRate);
                data.last_updated = new Date().toISOString();
                this.saveData(data);
                this.notifyUpdate();
                
                return newRate;
            }
            
            updateRate(rateId, newPrice, newQuality) {
                const data = JSON.parse(localStorage.getItem(this.DB_KEY));
                const rateIndex = data.rates.findIndex(rate => rate.id === rateId);
                
                if (rateIndex !== -1) {
                    data.rates[rateIndex].price = newPrice.toString();
                    data.rates[rateIndex].quality = newQuality;
                    data.rates[rateIndex].date = this.getTodayDate();
                    data.last_updated = new Date().toISOString();
                    
                    this.saveData(data);
                    this.notifyUpdate();
                    return true;
                }
                return false;
            }
            
            deleteRate(rateId) {
                const data = JSON.parse(localStorage.getItem(this.DB_KEY));
                const initialLength = data.rates.length;
                
                data.rates = data.rates.filter(rate => rate.id !== rateId);
                data.last_updated = new Date().toISOString();
                
                this.saveData(data);
                this.notifyUpdate();
                
                return initialLength !== data.rates.length;
            }
            
            getVegetables() {
                const data = JSON.parse(localStorage.getItem(this.DB_KEY));
                return data ? data.vegetables : [];
            }
            
            getLastUpdateTime() {
                const data = JSON.parse(localStorage.getItem(this.DB_KEY));
                return data ? data.last_updated : null;
            }
            
            saveData(data) {
                localStorage.setItem(this.DB_KEY, JSON.stringify(data));
            }
            
            notifyUpdate() {
                localStorage.setItem('mandi_db_updated', Date.now().toString());
                
                if (typeof BroadcastChannel !== 'undefined') {
                    const channel = new BroadcastChannel('mandi_updates');
                    channel.postMessage('rates_updated');
                }
            }
            
            onUpdate(callback) {
                window.addEventListener('storage', (e) => {
                    if (e.key === 'mandi_db_updated') {
                        callback();
                    }
                });
                
                if (typeof BroadcastChannel !== 'undefined') {
                    const channel = new BroadcastChannel('mandi_updates');
                    channel.addEventListener('message', (event) => {
                        if (event.data === 'rates_updated') {
                            callback();
                        }
                    });
                }
            }
        }

        // Create global database instance
        const mandiDB = new SabziMandiDB();

        // User Interface Functions
        const cityNames = {
            'multan': {en: 'Multan', ur: 'Ù…Ù„ØªØ§Ù†'},
            'khanewal': {en: 'Khanewal', ur: 'Ø®Ø§Ù†ÛŒÙˆØ§Ù„'},
            'kabirwala': {en: 'Kabirwala', ur: 'Ú©Ø¨ÛŒØ±ÙˆØ§Ù„Û'}
        };

        const qualityNames = {
            'good': {en: 'Good', ur: 'Ø§Ú†Ú¾Ø§'},
            'medium': {en: 'Medium', ur: 'Ø¯Ø±Ù…ÛŒØ§Ù†Û'},
            'fresh': {en: 'Fresh', ur: 'ØªØ§Ø²Û'},
            'premium': {en: 'Premium', ur: 'Ø§Ø¹Ù„ÛŒÙ°'}
        };

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            notification.style.background = type === 'success' ? '#4CAF50' : 
                                           type === 'error' ? '#f44336' : '#2196F3';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function loadRatesForCity(city) {
            const rates = mandiDB.getRatesByCity(city);
            const tableBody = document.getElementById(`${city}-rates`);
            const updateDiv = document.getElementById(`${city}-update`);
            
            if (!tableBody) return;
            
            let html = '';
            
            if (rates.length === 0) {
                html = `<tr>
                    <td colspan="4" style="text-align:center; padding:30px; color:#666;">
                        ğŸ“­ Ø¢Ø¬ Ú©ÛŒ Ù‚ÛŒÙ…ØªÛŒÚº Ø¯Ø³ØªÛŒØ§Ø¨ Ù†ÛÛŒÚº ÛÛŒÚº<br>
                        Today's rates are not available
                    </td>
                </tr>`;
            } else {
                rates.forEach(rate => {
                    const quality = qualityNames[rate.quality] || {ur: rate.quality, en: rate.quality};
                    html += `
                    <tr>
                        <td>${rate.vegetable_urdu} | ${rate.vegetable_name}</td>
                        <td class="price">â‚¨ ${rate.price}</td>
                        <td>${rate.unit}</td>
                        <td>${quality.ur} | ${quality.en}</td>
                    </tr>`;
                });
            }
            
            tableBody.innerHTML = html;
            
            // Update timestamp
            const lastUpdate = mandiDB.getLastUpdateTime();
            if (lastUpdate) {
                const time = new Date(lastUpdate).toLocaleTimeString('en-PK', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                updateDiv.innerHTML = `âœ… Ø¢Ø®Ø±ÛŒ Ø§Ù¾ ÚˆÛŒÙ¹: ${time} | Last Update: ${time}`;
            }
        }

        function showCity(city) {
            // Update active tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show selected city card
            document.querySelectorAll('.market-card').forEach(card => {
                card.classList.remove('active');
            });
            document.getElementById(`${city}-card`).classList.add('active');
            
            // Load rates for this city
            loadRatesForCity(city);
        }

        function setupAutoRefresh() {
            mandiDB.onUpdate(() => {
                showNotification('ğŸ”„ Ù‚ÛŒÙ…ØªÛŒÚº Ø§Ù¾ ÚˆÛŒÙ¹ ÛÙˆ Ú¯Ø¦ÛŒ ÛÛŒÚº! | Rates updated!', 'success');
                
                // Reload current city
                const activeCard = document.querySelector('.market-card.active');
                if (activeCard) {
                    const city = activeCard.id.replace('-card', '');
                    loadRatesForCity(city);
                }
            });
        }

        function initialize() {
            // Load Multan rates by default
            loadRatesForCity('multan');
            
            // Setup auto-refresh
            setupAutoRefresh();
            
            // Auto-refresh every 30 seconds
            setInterval(() => {
                const activeCard = document.querySelector('.market-card.active');
                if (activeCard) {
                    const city = activeCard.id.replace('-card', '');
                    loadRatesForCity(city);
                }
            }, 30000);
            
            console.log('Sabzi Mandi App initialized successfully');
        }

        // Start the app
        window.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
